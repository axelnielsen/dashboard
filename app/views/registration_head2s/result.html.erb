<%
txtName=params[:txtName]
txtLastName=params[:txtLastName]
txtAn=params[:txtAn]
txtClub=params[:txtClub]
txtName=params[:txtName]
txtRegion=params[:txtRegion]
arr=params[:competitions]
@lastTrackHead=0
 arr.each do |e|
arrCount=nil
%>
<%=e%>
<%sql = "select count(*) from track_head2s  where track_head2s.competition_id="+e.inspect+" ;
"   
    arrCount = ActiveRecord::Base.connection.execute(sql)

arrCount.each do |t|
%>
<%
if t[0]==0 
arrTrackHead2s=nil
@lastTrackHead=nil
sqlTrackHead2s = "insert into track_head2s (competition_id, serie, created_at, updated_at) values("+e+", 'INSCRITOS', '"+Time.now.strftime('%Y/%m/%d')+"', '"+Time.now.strftime('%Y/%m/%d')+"');"   
    arrTrackHead2s = ActiveRecord::Base.connection.execute(sqlTrackHead2s)
@lastTrackHead=TrackHead2.last.id.to_s
	sqlTrackHead2s="select id from track_head2s where competition_id="+e+";"
	arrTrackHead2s = ActiveRecord::Base.connection.execute(sqlTrackHead2s)
	arrTrackHead2s.each do |l|
	@lastTrackHead=l[0].to_s
	end
%>
@lastTrackHead=<%=@lastTrackHead%>
<%
else
	sqlTrackHead2s="select id from track_head2s where competition_id="+e+";"
	arrTrackHead2s = ActiveRecord::Base.connection.execute(sqlTrackHead2s)
	arrTrackHead2s.each do |l|
	@lastTrackHead=l[0].to_s
	end

end

sqlTrack2s = "insert into track2s (athlete, track_head2_id, club, region, created_at, updated_at, an) values('"+txtName+" "+txtLastName+"', "+@lastTrackHead+",'"+txtClub+"', '"+txtRegion+"', '"+Time.now.strftime('%Y/%m/%d')+"', '"+Time.now.strftime('%Y/%m/%d')+"', '"+txtAn+"');"   
    arrCount = ActiveRecord::Base.connection.execute(sqlTrack2s)
%>
<%=sqlTrackHead2s %><br/>
<%=sqlTrack2s%><br/>
<%end%>
<%
 end

%>


Aquí va el mensaje del resultado de la inscripción